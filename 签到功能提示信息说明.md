# 教练签到功能提示信息说明

## 概述
教练签到功能现在提供详细的、多样化的提示信息，帮助教练了解签到失败的具体原因。

## 提示信息类型

### 🟢 成功消息 (绿色)
- **样式**：绿色背景，带对勾图标
- **示例**：`上班签到成功！时间：2026-01-23 14:30:25`

### 🔴 错误消息 (红色)
- **样式**：红色背景，带警告图标
- **适用情况**：
  - 系统错误或异常
  - 操作顺序错误（如未签到就签退）
  - 数据库操作失败

### 🟡 警告消息 (黄色)
- **样式**：黄色背景，带感叹号图标
- **适用情况**：
  - 重复操作
  - 当前时段无排课
  - 非工作时间

### 🔵 信息消息 (蓝色)
- **样式**：蓝色背景，带信息图标
- **适用情况**：一般性提示信息

## 具体提示信息列表

### 1. 未登录访问
- **触发条件**：用户未登录直接访问签到页面
- **行为**：自动重定向到登录页面
- **提示**：无（直接跳转）

### 2. 无效签到类型
- **触发条件**：提交的checkType参数不是"1"或"2"
- **提示**：`无效的签到类型！`
- **样式**：红色错误消息

### 3. 非工作时间
- **触发条件**：当前时间不在6:00-22:00之间
- **提示**：`当前时间段为非工作时间（6:00-22:00），签到功能暂时不可用。如有特殊情况请联系管理员。`
- **样式**：黄色警告消息

### 4. 当前时段无排课
- **触发条件**：教练当前时间前后1小时内没有排课
- **提示**：`当前时间段没有您的课程安排，无法进行签到。请在课程开始前1小时到课程结束后1小时的时间范围内进行签到。如需测试功能，请联系管理员。`
- **增强功能**：显示最近的课程安排信息，包括课程名称、时间和距离当前时间的时长
- **样式**：黄色警告消息

### 5. 重复签到
- **触发条件**：今日已完成相同类型的签到
- **提示**：`您今日已经完成上班签到/下班签退，不能重复操作！如需修改请联系管理员。`
- **样式**：黄色警告消息

### 6. 签退前未签到
- **触发条件**：尝试下班签退但今日未进行上班签到
- **提示**：`请先完成上班签到，才能进行下班签退！请确保今日已进行过上班签到。`
- **样式**：红色错误消息

### 7. 签到成功
- **触发条件**：签到操作成功完成
- **提示**：`上班签到成功！时间：2026-01-23 14:30:25`
- **样式**：绿色成功消息

### 8. 签到失败
- **触发条件**：数据库插入操作返回0行影响
- **提示**：`上班签到失败，请重试！`
- **样式**：红色错误消息

### 9. 系统异常
- **触发条件**：程序运行中出现异常
- **提示**：`系统异常，请稍后重试或联系管理员！`
- **样式**：红色错误消息

## 测试用例

### 成功场景
1. **正常签到**：
   - 前提：教练登录，有当前时段排课，未重复操作
   - 结果：显示绿色成功消息

### 失败场景
1. **无课程签到**：
   - 前提：教练登录，无当前时段课程安排
   - 结果：显示黄色警告消息

2. **重复签到**：
   - 前提：教练今日已签到，再次尝试相同操作
   - 结果：显示黄色警告消息

3. **顺序错误**：
   - 前提：教练尝试下班签退但未上班签到
   - 结果：显示红色错误消息

4. **非工作时间**：
   - 前提：凌晨或深夜尝试签到
   - 结果：显示黄色警告消息

## 技术实现

### 后端 (CheckInServlet.java)
- 根据不同错误类型设置 `msg` 和 `msgType` 属性
- `msgType` 取值：success, danger, warning, info
- **增强功能**：
  - `CourseCheckResult` 类：封装课程检查结果和失败原因
  - `getNextCourseInfo()` 方法：查询并格式化最近课程信息
  - 提供详细的失败原因，包括课程名称、时间和时间差

### 前端 (checkIn.jsp)
- 使用 `<c:choose>` 根据 `msgType` 显示不同颜色的alert
- 添加相应的图标和样式
- 优化状态信息显示，提供友好的中文状态描述和颜色编码
- **修复通知显示问题**：
  - 添加 `fn` 标签库支持换行符显示
  - 添加JavaScript alert确保错误和警告消息可见

### 样式说明
```jsp
<c:when test="${msgType == 'success'}">
    <div class="alert alert-success">...</div>
</c:when>
<c:when test="${msgType == 'danger'}">
    <div class="alert alert-danger">...</div>
</c:when>
<c:when test="${msgType == 'warning'}">
    <div class="alert alert-warning">...</div>
</c:when>
<c:otherwise>
    <div class="alert alert-info">...</div>
</c:otherwise>
```

## 使用说明

1. 重新部署包含更新的应用
2. 使用不同教练账号测试各种失败场景
3. 观察提示信息的颜色和内容是否符合预期
4. 根据提示信息指导用户进行正确的操作